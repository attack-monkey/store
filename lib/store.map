{"version":3,"sources":["src/index.ts","index.ts"],"names":[],"mappings":"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","file":"store.map","sourcesContent":["export class Store {\n\tstore: any;\n\tlocked: boolean;\n\tidCount: number = 1;\n\n\tconstructor(obj) {\n\t\tthis.store = cloner(obj);\n\t}\n\n\tget(key, options) { return get(key, options, this.store); }\n\n\tset(key, val) {\n\t\tif (this.locked) {\n\t\t\tconsole.log('This Store is locked. Unlock to perform set operations');\n\t\t} else {\n\t\t\tthis.store = iu(this.store, key, val);\n\t\t}\n\t}\n\n\tpush(key, val) {\n\t\tif (this.locked) {\n\t\t\tconsole.log('This Store is locked. Unlock to perform push operations');\n\t\t} else {\n\t\t\tconst valArray = isArray(val) ? val : [val];\n\t\t\tconst rows = valArray.reduce((ac, cv) => {\n\t\t\t\tac.push({ id: this.idCount, value: cv });\n\t\t\t\tthis.idCount++;\n\t\t\t\treturn ac;\n\t\t\t}, get(key, undefined, this.store) || []);\n\t\t\tthis.store = iu(this.store, key, rows);\n\t\t}\n\t}\n\n\tunshift(key, val) {\n\t\tif (this.locked) {\n\t\t\tconsole.log('This Store is locked. Unlock to perform unshift operations');\n\t\t} else {\n\t\t\tconst valArray = isArray(val) ? val : [val];\n\t\t\tconst rows = valArray.reduce((ac, cv) => {\n\t\t\t\tac.unshift({ id: this.idCount, value: cv });\n\t\t\t\tthis.idCount++;\n\t\t\t\treturn ac;\n\t\t\t}, get(key, undefined, this.store) || []);\n\t\t\tthis.store = iu(this.store, key, rows);\n\t\t}\n\t}\n\n\tupdate(key, val) {\n\t\tif (this.locked) {\n\t\t\tconsole.log('This Store is locked. Unlock to perform update operations');\n\t\t} else { update(key, val, this.store) }\n\t}\n\n\tapply(key, func) {\n\t\tif (this.locked) {\n\t\t\tconsole.log('This Store is locked. Unlock to perform apply operations');\n\t\t} else {\n\t\t\tconst pushArray = get(key, undefined, this.store);\n\t\t\treturn func(pushArray);\n\t\t}\n\t}\n\n\tlock() {\n\t\tthis.locked = true;\n\t}\n\n\tunlock() {\n\t\tthis.locked = false;\n\t}\n}\n\n// get -------------------------------------------------------------\n\nfunction get(key, options, store) {\n\tif (!key && !options) { return store; }\n\tif (!key && options) { return queryResult(store, options); }\n\telse if (key) {\n\t\tconst subArray = keyToArray(key);\n\t\tconst result = subArray.reduce((ac, cv, i, arr) => {\n\t\t\treturn ac ? objectAtNode(ac, cv) : undefined;\n\t\t}, store);\n\t\tif (!options) { return result } else {\n\t\t\treturn queryResult(result, options);\n\t\t}\n\t}\n}\n\n// END: get ----------------------------------------------------------\n\n// getting ids / keys and objects at a node --------------------------\n\nfunction objectAtNode(obj, key) {\n\treturn key.match(/\\$/) ? pushArrayRef(obj, key) : obj[key];\n}\n\nfunction posAtNode(obj, key) {\n\treturn key.match(/\\$/) ? pushArrayPosGetter(obj, key) : key;\n}\n\nfunction pushArrayRef(obj, key) {\n\ttry {\n\t\tif (!isArray(obj)) { throw ('Error with $ ref => ' + key + ' not referencing a pushArray'); }\n\t\telse {\n\t\t\treturn obj.filter(row => row.id === parseInt(key.replace('$', '')))[0];\n\t\t}\n\t} catch (e) { console.error(e); }\n}\n\nfunction pushArrayPosGetter(obj, key) {\n\ttry {\n\t\tif (!isArray(obj)) { throw ('Error with $ ref => ' + key + ' not referencing a pushArray'); }\n\t\telse {\n\t\t\tconst objToFind = obj.filter(row => row.id === parseInt(key.replace('$', '')))[0];\n\t\t\treturn obj.indexOf(objToFind);\n\t\t}\n\t} catch (e) { console.error(e); }\n}\n\n// END: getting ids / keys and objects at a node --------------------------\n\n// pushArray queries --------------------------------------------------\n\nfunction queryResult(obj, options) {\n\t/*\n   * queries are expected to be performed on pushArrays - not arrays... see readme\n   *\n   * options\n   * - filter: fn => boolean: Function that returns boolean for each result\n   * - limit: number: Limits the final result set to the specified limit\n   * - sort: Array<{by: string, dir: asc | desc}>: Sorts the result set by this key\n   */\n\tobj = filterResults(obj, options.filter);\n\tobj = sortResults(obj, options.sort);\n\tobj = limitResults(obj, options.limit);\n\tif (!options.meta) {\n\t\treturn Object.keys(obj).map(key => obj[key].value);\n\t} else { return obj; }\n}\n\nfunction filterResults(obj, filter) {\n\tif (!filter) { return Object.keys(obj).map(key => obj[key]); }\n\telse {\n\t\treturn Object\n\t\t\t.keys(obj)\t// get keys as array\n\t\t\t.map(key => obj[key]) // get the values as array\n\t\t\t.filter(item => filter(item))\t// apply the filter function to each item in array\n\t}\n}\n\nfunction sortResults(obj, sort) {\n\tif (!sort) { return obj } else {\n\t\tconst sortObjArray = isArray(sort) ? sort : [sort];\n\t\tconst values = numberSort(objToValueArray(obj), sortObjArray);\n\t\treturn values;\n\t}\n}\n\nfunction limitResults(obj, limit) {\n\tif (!limit) { return obj } else {\n\t\tconst newKeys = Object.keys(obj);\n\t\tif (limit < newKeys.length) { newKeys.length = limit }\n\t\treturn newKeys.map(key => obj[key]);\n\t}\n}\n\n// set ------------------------------------------------\n\nfunction iu(state, subArray, val) {\n\tsubArray = keyToArray(subArray);\n\treturn reducer(state, subArray, val ? cloner(val) : undefined, 0);\n}\n\nfunction keyToArray(subArray) {\n\ttry {\n\t\tif (!subArray) { throw 'No target provided'; } else\n\t\t\tif (subArray.length < 1) { throw 'No target provided'; } else\n\t\t\t\treturn subArray.split('/').filter(segment => segment);\n\t} catch (error) { console.error('Error in reading keys', error) }\n}\n\nfunction reducer(_state, subArray, val, l) {\n\ttry {\n\t\tconst key = posAtNode(_state, subArray[l]); // gets the position of pushArray, else the key of an object\n\t\tif (l + 1 === subArray.length) {\n\t\t\tconst value = val;\n\t\t\tconst replacer =\n\t\t\t\tval === undefined ||\n\t\t\t\t\tval === null ||\n\t\t\t\t\ttypeof val === 'object' && Array.isArray(val) && val.length === 0 ||\n\t\t\t\t\ttypeof val === 'object' && !Array.isArray(val) && Object.keys(val).length === 0 ? undefined : val;\n\t\t\tif (isArray(_state)) {\n\t\t\t\tconst clonedState = cloner(_state);\n\t\t\t\tif (replacer) {\n\t\t\t\t\tclonedState.splice(key, 1, replacer);\n\t\t\t\t\treturn clonedState;\n\t\t\t\t} else {\n\t\t\t\t\tclonedState.splice(key, 1);\n\t\t\t\t\treturn clonedState;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\treturn Object.assign({}, _state, { [key]: replacer });\n\t\t\t}\n\t\t}\n\t\telse {\n\t\t\tconst value = _state[key] ? _state[key] : {};\n\t\t\tif (isArray(_state)) {\n\t\t\t\tconst clonedState = cloner(_state);\n\t\t\t\tclonedState.splice(key, 1, reducer(value, subArray, val, l + 1));\n\t\t\t\treturn clonedState;\n\t\t\t} else {\n\t\t\t\treturn Object.assign({}, _state, { [key]: reducer(value, subArray, val, l + 1) });\n\t\t\t}\n\t\t}\n\t} catch (error) { console.error('reducer error =>', error); }\n}\n\n// END: set ------------------------------------------------\n\n// array sort functions -------------------------------------------------------\n\nfunction numberSort(arr, sortArr, direction?) {\n\tlet sortLevel = 0;\n\tconst result = arr.reduce((ac, cv, i, arr) => {\n\t\tif (!ac.old) { ac.old = arr }\n\t\tconst targetItem = sortArr[sortLevel].dir && sortArr[sortLevel].dir === 'desc' ?\n\t\t\tlargest(ac.old, sortArr, sortLevel)\n\t\t\t:\n\t\t\tsmallest(ac.old, sortArr, sortLevel);\n\t\tconst newArray = [...ac.new, targetItem];\n\t\tconst oldArray = ac.old.filter(item => item !== targetItem);\n\t\treturn { old: oldArray, new: newArray };\n\t}, { new: [] }).new;\n\treturn result;\n}\n\nfunction smallest(arr, sortArr, sortLevel) {\n\ttry {\n\t\treturn arr.reduce((ac, cv, i, arr) => {\n\t\t\treturn whichIsSmaller(ac, cv, sortArr, sortLevel);\n\t\t})\n\t} catch (e) { console.error('Error - Trying to sort by an object instead of a value!'); }\n}\n\nfunction whichIsSmaller(ac, cv, sortArr, sortLevel) {\n\tconst acVal = sortByRetriever(ac, sortArr[sortLevel].by);\n\tconst curVal = sortByRetriever(cv, sortArr[sortLevel].by);\n\tif (typeof acVal === 'object' || typeof curVal === 'object') { throw (true); } else\n\t\tif (ifMC(acVal) < ifMC(curVal)) { return ac; } else\n\t\t\tif (ifMC(acVal) > ifMC(curVal)) { return cv; } else\n\t\t\t\t// comparitor and accumulator are same - if last sort level return ac\n\t\t\t\tif (sortArr.length - 1 === sortLevel) { return ac; }\n\t\t\t\telse {\n\t\t\t\t\t// There are more sort levels - increase the sort level\n\t\t\t\t\tsortLevel++;\n\t\t\t\t\tif (sortArr[sortLevel].dir && sortArr[sortLevel].dir === 'desc') {\n\t\t\t\t\t\treturn whichIsLarger(ac, cv, sortArr, sortLevel);\n\t\t\t\t\t} else { return whichIsSmaller(ac, cv, sortArr, sortLevel); }\n\t\t\t\t}\n}\n\nfunction largest(arr, sortArr, sortLevel) {\n\ttry {\n\t\treturn arr.reduce((ac, cv, i, arr) => {\n\t\t\treturn whichIsLarger(ac, cv, sortArr, sortLevel);\n\t\t})\n\t} catch (e) { console.error('Error - Trying to sort by an object instead of a value!'); }\n}\n\nfunction whichIsLarger(ac, cv, sortArr, sortLevel) {\n\tconst acVal = sortByRetriever(ac, sortArr[sortLevel].by);\n\tconst curVal = sortByRetriever(cv, sortArr[sortLevel].by);\n\tif (typeof acVal === 'object' || typeof curVal === 'object') { throw (true); } else\n\t\tif (ifMC(acVal) > ifMC(curVal)) { return ac; } else\n\t\t\tif (ifMC(acVal) < ifMC(curVal)) { return cv; } else\n\t\t\t\t// comparitor and accumulator are same - if last sort level return ac\n\t\t\t\tif (sortArr.length - 1 === sortLevel) { return ac; }\n\t\t\t\telse {\n\t\t\t\t\t// There are more sort levels - increase the sort level\n\t\t\t\t\tsortLevel++;\n\t\t\t\t\tif (sortArr[sortLevel].dir && sortArr[sortLevel].dir === 'desc') {\n\t\t\t\t\t\treturn whichIsLarger(ac, cv, sortArr, sortLevel);\n\t\t\t\t\t} else { return whichIsSmaller(ac, cv, sortArr, sortLevel); }\n\t\t\t\t}\n}\n\n// update ---------------------------------\n\nfunction update(key, val, store) {\n\ttry {\n\t\tconst subArray = keyToArray(key);\n\t\tconst valArray = isArray(val) ? val : [val];\n\t\tconst rows = valArray.reduce((ac, cv) => {\n\t\t\tconst objToFind = ac.filter(row => row.id === cv.id);\n\t\t\tif (objToFind.length === 0) {\n\t\t\t\tthrow ('Cannot update a row that doesn\\'t exist');\n\t\t\t} else {\n\t\t\t\tconst pos = ac.indexOf(objToFind[0]);\n\t\t\t\tac.splice(pos, 1, cv);\n\t\t\t\treturn ac;\n\t\t\t}\n\t\t}, get(key, undefined, store) || []);\n\t} catch (e) { console.error(); }\n}\n\n// END: update ---------------------------------\n\n// Utilities ----------------\n\nfunction ifMC(arg) {\n\t// if string make mixed case all lower case\n\treturn typeof arg === 'string' ? arg.toLowerCase() : arg;\n}\n\nfunction sortByRetriever(obj, by) {\n\treturn by.split('/').reduce((ac, cv) => {\n\t\treturn ac[cv];\n\t}, obj);\n}\n\nfunction cloner(arg) {\n\treturn JSON.parse(JSON.stringify(arg));\n}\n\nfunction objToValueArray(obj) {\n\treturn Object.keys(obj).map(key => obj[key]);\n}\n\nfunction isArray(val) {\n\treturn typeof val === 'object' && Array.isArray(val);\n}","import { Store } from './src';\n\n// create a new store...\n\nlet state = new Store({});\n\n// push items into the store at l1.l2.l3 as a pushArray\n\nstate.push('l1/l2/l3',[\n  {cat: 'red', val: 1}, \n  {cat: 'blue', val: 2}, \n  {cat: 'red', val: 87},\n  {cat: 'red', val: 4},\n  {cat: 'red', val: 45}\n]);\n\n// update a pushArray item using .set()\n\nstate.set('l1/l2/l3/$3/value', {cat: 'red', val: 455});\n\n// update multiple pushArray items with .update() ## this is the preferred method\nstate.update('l1/l2/l3', [\n\t{id: 1, value: {cat: 'blue', val: -600}},\n  {id: 4, value: {cat: 'blue', val: -1600}}\n]);\n\n// query the pushArray at l1.l2.l3 and sort by value/cat ascending, then value/val descending\n// Stringify (and prettify) the result\n\nlet result = JSON.stringify(state.get('l1/l2/l3', {\n\tsort: [\n  \t{by: 'value/cat'},\n  \t{by: 'value/val', dir: 'desc'}\n  ]\n}),null, 2);\n\n// print result\ndocument.querySelector('#response')\n.innerHTML = result;"]}